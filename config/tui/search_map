function! NvimIdeLocalSearch(mode)
    let @/ = expand("<cword>")
    " TODO: to add 'expand("<cword>")' into search history only after non-null search

    let special_symbol = ""
    if a:mode == "i"
        let special_symbol = nvim_replace_termcodes("<C-o>", v:true, v:false, v:true)
    endif

    call feedkeys(special_symbol . "/")
endfunction

" Search in bufer
"     Call search
set ignorecase
set smartcase
nnoremap <C-F> :noh <bar> call NvimIdeLocalSearch("n")<CR>
inoremap <C-F> <C-O>:noh <bar> call NvimIdeLocalSearch("i")<CR>
snoremap <C-F> <C-O>y/<C-r>"

"     Continue search
" TODO: nnoremap works incorrect: when cursor in (1,1) pos, then it dos not search (possibly stop after <Left> failure)
nnoremap <f3> <Left>nzzgn<C-g>
inoremap <f3> <Left><C-O>n<C-O>zz<C-O>gn<C-g>
smap <f3> <Esc><f3>

" Search files
function! NvimIdeFindFiles()
    let l:dir = getcwd()
    if exists("g:nvim_ide_project_root")
        let l:dir = g:nvim_ide_project_root
    endif
    call fzf#run(fzf#wrap({'source': 'cd ' . l:dir . '; ' . g:nvim_ide_fzf_source,
                                   \ 'options': '--prompt="File> " --multi --history='.NvimIdeGetProjectExtraFilesDir().'/fzf_search_files_history '.
                                   \            '--bind=' . g:nvim_ide_fzf_bind,
                                   \ 'dir': l:dir}))
endfunction

inoremap <C-k> <C-o>:call NvimIdeFindFiles()<CR>
nnoremap <C-k> :call NvimIdeFindFiles()<CR>

"     Call search
nnoremap <M-f> :call NvimIdeSearchInFilesContent(0, "")<CR>
inoremap <M-f> <C-o>:call NvimIdeSearchInFilesContent(1, "")<CR>
snoremap <M-f> <C-o>y:call NvimIdeSearchInFilesContent(0, getreg())<CR>
