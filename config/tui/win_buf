" To change current directory automatically according to opened file in current window
set autochdir

" Switch windows
noremap <C-w> <C-w>w
inoremap <C-w> <C-O><C-w>w
cnoremap <C-w> <C-O><C-w>w
onoremap <C-w> <C-O><C-w>w
"     in 'terminal' mode
tnoremap <C-w> <C-\><C-N><C-w>wi

" Close window without closing buffer
noremap <M-c> <C-w>c
inoremap <M-c> <C-O><C-w>c
cnoremap <M-c> <C-O><C-w>c
onoremap <M-c> <C-O><C-w>c
"     in 'terminal' mode
tnoremap <M-c> <C-\><C-N><C-w>c

" Close buffer without closing window
" Do not switch to 'QuickFix' buffer on it's existence
function! NvimIdeCloseCurrBuf()
    let currBuf = bufnr()
    if getbufinfo(currBuf)[0].changed == 1
        throw "NvimIde: failed to close modified buffer"
    endif

    exe 'silent bn'

    let err = ""
    try
        if getbufinfo(bufnr())[0].variables.current_syntax == 'qf'
            exe 'silent bn'
            if bufnr() == currBuf
                let err = "NvimIde: failed to close the only file buffer"
            endif
        endif
    catch
    endtry

    if len(err)
        throw err
    endif

    exe 'bd '.currBuf
endfunction

noremap <silent> <M-z> :call NvimIdeCloseCurrBuf()<CR>
inoremap <silent> <M-z> <C-O>:call NvimIdeCloseCurrBuf()<CR>

" Split window vertically
noremap <silent> <M-m> <C-w>v<C-w>w
inoremap <silent> <M-m> <C-O><C-w>v<C-o><C-w>w

" Switch buffers
function! NvimIdeBuffers()
    let l:cwd_au = getcwd()
    exe 'cd '.g:nvim_ide_project_root
    call fzf#vim#buffers({'options': ['--layout=reverse', '--cycle', '--exact']})
    exe 'cd '.l:cwd_au
endfunction

inoremap <C-PageUp> <C-o>:call NvimIdeBuffers()<CR>
nnoremap <C-PageUp> :call NvimIdeBuffers()<CR>
inoremap <C-PageDown> <C-o>:call NvimIdeBuffers()<CR>
nnoremap <C-PageDown> :call NvimIdeBuffers()<CR>

" Win/Buf navigation using 'jumps'
" TODO: test 'set jumpoptions+=stack' behaviour

augroup NvimIdeWindows
    autocmd!
    autocmd VimEnter * clearjumps
augroup END

noremap <M-left> <C-o>
inoremap <M-left> <C-o><C-o>
snoremap <M-left> <Esc><C-o>

noremap <M-right> <C-i>
inoremap <M-right> <C-o><C-i>
snoremap <M-right> <Esc><C-i>

