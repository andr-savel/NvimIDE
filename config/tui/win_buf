" To change current directory automatically according to opened file in current window
set autochdir

" Switch windows
noremap <C-w> <C-w>w
inoremap <C-w> <C-O><C-w>w
cnoremap <C-w> <C-O><C-w>w
onoremap <C-w> <C-O><C-w>w
"     in 'terminal' mode
tnoremap <C-w> <C-\><C-N><C-w>wi

" Close window without closing buffer
noremap <M-c> <C-w>c
inoremap <M-c> <C-O><C-w>c
cnoremap <M-c> <C-O><C-w>c
onoremap <M-c> <C-O><C-w>c
"     in 'terminal' mode
tnoremap <M-c> <C-\><C-N><C-w>c

" Close buffer without closing window
" Do not switch to 'QuickFix' buffer on it's existence
function! NvimIdeCloseCurrBuf()
    let currBuf = bufnr()
    if getbufinfo(currBuf)[0].changed == 1
        throw "NvimIde: failed to close modified buffer"
    endif

    exe 'silent bn'

    let err = ""
    try
        if getbufinfo(bufnr())[0].variables.current_syntax == 'qf'
            exe 'silent bn'
            if bufnr() == currBuf
                let err = "NvimIde: failed to close the only file buffer"
            endif
        endif
    catch
    endtry

    if len(err)
        throw err
    endif

    exe 'bd '.currBuf
endfunction

noremap <silent> <M-z> :call NvimIdeCloseCurrBuf()<CR>
inoremap <silent> <M-z> <C-O>:call NvimIdeCloseCurrBuf()<CR>

" Split window vertically
noremap <silent> <M-m> <C-w>v<C-w>w
inoremap <silent> <M-m> <C-O><C-w>v<C-o><C-w>w


"------------------------------------------
" TODO: switch between buffers

